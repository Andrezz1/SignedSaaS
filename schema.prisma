generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AuditUtilizador {
  AuditUtilizadorId   Int       @id @default(autoincrement())
  Entidade            String
  Operacao            String
  DataHora            DateTime  @default(now())
  IdUtilizadorResponsavel Int
  ParametrosRecebidos Json
  DadosAntes          Json?
  DadosDepois         Json?
  Resultado           String
  MensagemErro        String?

  UtilizadorResponsavel Utilizador? @relation(fields: [IdUtilizadorResponsavel], references: [id])
}

model AuditTipoSubscricao {
  AuditTipoSubscricaoId   Int       @id @default(autoincrement())
  Entidade                String
  Operacao                String
  DataHora                DateTime  @default(now())
  IdUtilizadorResponsavel Int
  ParametrosRecebidos     Json
  DadosAntes              Json?
  DadosDepois             Json?
  Resultado               String
  MensagemErro            String?

  UtilizadorResponsavel   Utilizador @relation(fields: [IdUtilizadorResponsavel], references: [id])
}

model CodigoPostal {
  CodigoPostalId Int    @id @default(autoincrement())
  Localidade     String
  Moradas        Morada[]
}

model Comprovativo {
  ComprovativoId Int        @id @default(autoincrement())
  Pagamento      Pagamento  @relation(fields: [PagamentoPagamentoId], references: [PagamentoId])
  Subscricao     Subscricao @relation(fields: [SubscricaoSubscricaoId], references: [SubscricaoId])
  Utilizador     Utilizador @relation(fields: [UtilizadorId], references: [id])
  
  PagamentoPagamentoId    Int
  SubscricaoSubscricaoId  Int
  UtilizadorId  Int
}

model Contacto {
  ContactoId Int     @id @default(autoincrement())
  Email      String
  Telemovel  String
  Utilizadores Utilizador[]
}

model DetalheSubscricao {
  DetalheSubscricaoId  Int            @id @default(autoincrement())
  Quantidade           Int
  Desconto            Float?
  ValorFinal          Float
  Subscricao          Subscricao @relation(fields: [SubscricaoSubscricaoId], references: [SubscricaoId])
  TipoSubscricao      TipoSubscricao @relation(fields: [TipoSubscricaoTipoSubscricaoID], references: [TipoSubscricaoID])
  
  SubscricaoSubscricaoId    Int
  TipoSubscricaoTipoSubscricaoID  Int
}

model Doacao {
  DoacaoId    Int       @id @default(autoincrement())
  ValorDoacao Float
  DataDoacao  DateTime
  Nota        String
  Utilizador  Utilizador @relation(fields: [UtilizadorId], references: [id])
  
  UtilizadorId Int
}

model MetodoPagamento {
  MetodoPagamentoId Int    @id @default(autoincrement())
  Nome             String @unique
  Pagamentos       Pagamento[]
}

model Morada {
  MoradaId                 Int           @id @default(autoincrement())
  Concelho                 String
  Distrito                 String
  CodigoPostal             CodigoPostal @relation(fields: [CodigoPostalCodigoPostalId], references: [CodigoPostalId])
  Utilizadores             Utilizador[]
  
  CodigoPostalCodigoPostalId Int
}

model Pagamento {
  PagamentoId   Int       @id @default(autoincrement())
  Valor         Int
  DadosEspecificos   Json? 
  DataPagamento DateTime
  EstadoPagamento String
  NIFPagamento   String
  Utilizador     Utilizador @relation(fields: [UtilizadorId], references: [id])
  MetodoPagamento   MetodoPagamento @relation(fields: [MetodoPagamentoId], references: [MetodoPagamentoId])
  Subscricoes    Subscricao[]
  Comprovativos  Comprovativo[]
  
  MetodoPagamentoId Int @default(1) 
  UtilizadorId Int
}

model Subscricao {
  SubscricaoId      Int             @id @default(autoincrement())
  DataInicio        DateTime
  DataFim          DateTime
  EstadoSubscricao Boolean    @default(false)
  Utilizador       Utilizador @relation(fields: [UtilizadorId], references: [id])
  Pagamento        Pagamento?  @relation(fields: [PagamentoPagamentoId], references: [PagamentoId])
  TipoSubscricao   TipoSubscricao @relation(fields: [TipoSubscricaoTipoSubscricaoID], references: [TipoSubscricaoID])
  Comprovativos    Comprovativo[]
  Detalhes         DetalheSubscricao[]
  
  UtilizadorId Int
  PagamentoPagamentoId   Int?
  TipoSubscricaoTipoSubscricaoID Int
}

model TipoSubscricao {
  TipoSubscricaoID Int                 @id @default(autoincrement())
  Descricao        String
  Preco           Int
  Subscricoes      Subscricao[]
  Detalhes         DetalheSubscricao[]
}

model TipoUtilizador {
  TipoUtilizadorId Int          @id @default(autoincrement())
  Descricao        String
  Utilizadores     Utilizador[]
}

model Utilizador {
  id Int             @id @default(autoincrement())
  NumSocio     Int?            @unique
  Nome         String?
  Username     String?         @unique
  DataNascimento DateTime?
  NIF          String?         @unique
  EstadoUtilizador Boolean    @default(true)
  Morada       Morada?        @relation(fields: [MoradaMoradaId], references: [MoradaId])
  Contacto     Contacto?      @relation(fields: [ContactoContactoId], references: [ContactoId])
  TipoUtilizador TipoUtilizador? @relation(fields: [TipoUtilizadorTipoUtilizadorId], references: [TipoUtilizadorId])
  Pagamentos    Pagamento[]
  Subscricoes   Subscricao[]
  Comprovativos Comprovativo[]
  Doacoes       Doacao[]
  UtilizadorFiltro UtilizadorFiltro[]
  AuditUtilizador AuditUtilizador[]
  AuditTipoSubscricao AuditTipoSubscricao[]
  Imagem        String?
  
  MoradaMoradaId         Int?
  ContactoContactoId     Int?
  TipoUtilizadorTipoUtilizadorId Int  @default(1)
}

model UtilizadorFiltro {
  UtilizadorFiltroId         Int      @id @default(autoincrement())
  nomeFiltro      String
  filtros    Json     
  UtilizadorId     Int
  Utilizador       Utilizador @relation(fields: [UtilizadorId], references: [id])
}